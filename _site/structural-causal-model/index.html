<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Causal model with bayesian network</title>
  <meta name="description" content="In this previous post, I wrote about the language of causal inference via counterfactuals. I briefly mentioned that there are at least two ways to capture the causal effect: counterfactuals and structural causal model. In this post, we are going to look at structural causal model and how we can use it to simulate what would happen if we do an intervention to a particular variable of interest. Please do note that both counterfactuals and structural causal model are highly overlapped and they share the same underlying concepts.">
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dominant-baseline='central' font-size='52'%3Eüß†%3C/text%3E%3C/svg%3E">
  <style>body {
    max-width: 80ch;
    padding: 3em 1em;
    margin: auto;
    line-height: 1.6;
    font-size: 1.08em;
    font-family: Helvetica, Arial, sans-serif;
}

a {
    color: inherit;
}

a:hover {
    text-decoration: none;
}

img {
    max-width: 100%;
    height: auto;
}

pre {
    overflow: auto;
    background: #f7f7f7;
    padding: 0.75rem;
    border-radius: 6px;
    border: 1px solid #e5e5e5;
}

code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    background: #f7f7f7;
    padding: 0.1rem 0.35rem;
    border-radius: 4px;
}

blockquote {
    border-left: 3px solid #ddd;
    padding-left: 0.8rem;
    color: #444;
    margin: 1rem 0;
}

header.site-header {
    margin-bottom: 1.5rem;
}

nav ul {
    list-style: none;
    padding: 0;
    margin: 0.4rem 0 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.6rem 1rem;
}

nav a {
    text-decoration: none;
    border-bottom: 1px solid transparent;
}

nav a.active,
nav a:hover {
    border-color: #111;
}

section {
    margin: 1.8rem 0;
}

.meta {
    color: #555;
    font-size: 0.95rem;
}

.listing {
    width: 100%;
    border-collapse: collapse;
}

.listing td {
    padding: 0.2rem 0.15rem;
    vertical-align: baseline;
}

.listing tr+tr td {
    border-top: 1px solid #eee;
}

.listing .date {
    white-space: nowrap;
    padding-right: 0.8rem;
    color: #666;
    font-size: 0.95rem;
}

.tag {
    display: inline-block;
    padding: 0.1rem 0.55rem;
    border: 1px solid #ddd;
    border-radius: 999px;
    font-size: 0.85rem;
    margin-right: 0.35rem;
    color: #444;
}

footer {
    margin-top: 2.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
    color: #555;
    font-size: 0.95rem;
}

.tag-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 1.2rem;
}

.tag-btn {
    display: inline-block;
    padding: 0.2rem 0.7rem;
    border: 1px solid #ddd;
    border-radius: 999px;
    font-size: 0.85rem;
    background: #fff;
    color: #444;
    cursor: pointer;
    font-family: inherit;
    transition: background 0.15s, color 0.15s, border-color 0.15s;
}

.tag-btn:hover {
    border-color: #999;
}

.tag-btn.active {
    background: #24292e;
    color: #fff;
    border-color: #24292e;
}


.footer-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem 0.75rem;
    align-items: center;
    padding: 0;
    margin: 0.5rem 0 0;
    list-style: none;
}

.footer-links a {
    text-decoration: none;
    border-bottom: 1px solid transparent;
}

.footer-links a:hover {
    border-color: #111;
}

.icon {
    font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
    margin-right: 0.25rem;
}

.social-links {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem 0.8rem;
    padding: 0;
    margin: 0.5rem 0 0;
    list-style: none;
}

.social-links a {
    text-decoration: none;
    border-bottom: 1px solid transparent;
}

.social-links a:hover {
    border-color: #111;
}

@media (max-width: 640px) {
    body {
        font-size: 1em;
    }
}

/* Fix: reset code padding inside pre blocks to avoid first-line indent */
pre code {
    padding: 0;
    background: none;
    border-radius: 0;
}

/* Rouge syntax highlighting ‚Äî GitHub-inspired theme */
.highlight .c,
.highlight .c1,
.highlight .cm,
.highlight .cs {
    color: #6a737d;
    font-style: italic;
}

/* comments */
.highlight .k,
.highlight .kd,
.highlight .kn,
.highlight .kp,
.highlight .kr,
.highlight .kt,
.highlight .kc {
    color: #d73a49;
}

/* keywords */
.highlight .n {
    color: #24292e;
}

/* names */
.highlight .nf,
.highlight .nx {
    color: #6f42c1;
}

/* function names */
.highlight .nc {
    color: #6f42c1;
    font-weight: bold;
}

/* class names */
.highlight .nb {
    color: #005cc5;
}

/* builtins */
.highlight .bp {
    color: #005cc5;
}

/* builtin pseudo */
.highlight .s,
.highlight .s1,
.highlight .s2,
.highlight .sh,
.highlight .sb,
.highlight .sc,
.highlight .sd,
.highlight .se,
.highlight .si,
.highlight .sx {
    color: #032f62;
}

/* strings */
.highlight .sr {
    color: #032f62;
}

/* regex */
.highlight .ss {
    color: #005cc5;
}

/* symbol */
.highlight .mi,
.highlight .mf,
.highlight .mh,
.highlight .mo,
.highlight .mb,
.highlight .il {
    color: #005cc5;
}

/* numbers */
.highlight .o,
.highlight .ow {
    color: #d73a49;
}

/* operators */
.highlight .p {
    color: #24292e;
}

/* punctuation */
.highlight .na {
    color: #005cc5;
}

/* attribute names */
.highlight .nd {
    color: #6f42c1;
}

/* decorators */
.highlight .ni {
    color: #24292e;
    font-weight: bold;
}

/* entity */
.highlight .ne {
    color: #d73a49;
    font-weight: bold;
}

/* exception */
.highlight .nn {
    color: #005cc5;
}

/* namespace */
.highlight .no {
    color: #005cc5;
}

/* constant */
.highlight .nv,
.highlight .vi,
.highlight .vc,
.highlight .vg,
.highlight .vm {
    color: #e36209;
}

/* variables */
.highlight .ge {
    font-style: italic;
}

/* emphasis */
.highlight .gs {
    font-weight: bold;
}

/* strong */
.highlight .err {
    color: #d73a49;
    background: #ffeef0;
}

/* error */
.highlight .gd {
    color: #b31d28;
    background: #ffeef0;
}

/* diff deleted */
.highlight .gi {
    color: #22863a;
    background: #f0fff4;
}

/* diff inserted */</style>  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1K5SB4G23C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-1K5SB4G23C');
  </script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] }
    };
  </script>
  <script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>

<body>
  <main>
    <a href="/blog/" aria-label="Blog">‚Üê Blog</a>
<h1>Causal model with bayesian network</h1>
<p class="meta">
  August 26, 2021
  
  
   ¬∑ 10 min read 
</p>

<p>In this <a href="https://rezkaaufar.github.io/blog/2021/language-of-causal-model/">previous post</a>, I wrote about the language of causal inference via counterfactuals. I briefly mentioned that there are at least two ways to capture the causal effect: counterfactuals and structural causal model. In this post, we are going to look at structural causal model and how we can use it to simulate what would happen if we do an intervention to a particular variable of interest. Please do note that both counterfactuals and structural causal model are highly overlapped and they share the same underlying concepts.</p>

<h1 id="simpsons-paradox-in-an-acyclic-directed-graph">Simpson‚Äôs paradox in an acyclic directed graph</h1>
<p>I have mentioned about simpson‚Äôs paradox briefly in my previous blog post. Here I am going to illustrate another perspective on how simpson‚Äôs paradox can affect the result of classical machine learning. Consider a (true) causal graph below.</p>

<p><img src="/assets/img/scm-graph.png" alt="Figure 1: An example of a true causal graph between 5 variables" /></p>

<p><em>Figure 1: An example of a true causal graph between 5 variables.</em></p>

<p>Assume that we have data with these 5 variables in a spreadsheet style (think pandas dataframe) and we are tasked to find the effect on how exposure to sun ($T$) on the illness ($Y$). Without any knowledge of causal inference, we might think to just incorporate $T$ as feature and create a linear regression model on the label $Y$. Once we have the model, we use the coefficient to gauge and measure the relationship between exposure to sun and illness. If the coefficient is a positive number, then it tells us that there is a positive relationship, and vice versa if the coefficient is a negative number.</p>

<p><img src="/assets/img/scm-regression.png" alt="Figure 2: Results of two linear regressions using different features. (&lt;a href=&quot;https://www.youtube.com/watch?v=5JsFZbGqJzc&amp;t=1516s&amp;ab_channel=ODSAIGlobal&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;credits&lt;/a&gt;)" /></p>

<p><em>Figure 2: Results of two linear regressions using different features. (<a href="https://www.youtube.com/watch?v=5JsFZbGqJzc&amp;t=1516s&amp;ab_channel=ODSAIGlobal" target="_blank" rel="noopener noreferrer">credits</a>).</em></p>

<p>Looking at Figure 2 above, if we use $T$ as the single feature to predict $Y$, we got test RMSE of 10 and a coefficient of 0.99, meaning that there is a positive relationship between exposure to sun and illness. But if we were to add $C$ (type of car owned) as feature, then we would have an even better test RMSE of 7.7, hinting that type of car owned is helpful in predictive power. But if we inspect the coefficient, we see that now $T$ and $Y$ have a negative relationship, whereas $C$ and $Y$ have a positive relationship. How can this happen? How can knowing the type of car owned results in more predictive power to illness? To the naked eye, this seems pretty unintuitive. But if we know the true causal graph we will immediately realized that knowing $C$ indirectly tells us the age of the person, which gives it the predictive power to illness. This is another example of simpson‚Äôs paradox in a acyclic directed graph which we can use to distinguish flow of correlation vs causation.</p>

<hr />

<h1 id="bayesian-network">Bayesian Network</h1>

<p>We know that strong correlation between variables do not imply a causal effect. With counterfactuals, we introduce potential outcomes $(Y1, Y0)$ to be able to capture the causal effect. With structural causal model (SCM), the goal is to model the causal interdependencies between variables. One tool that we can use to achieve this is to use probabilistic graphical models (PGM). With PGM, we can model the relationships between features. PGM as a term encompasses many different approaches. In our case, one of the graph models that we can use to capture causal model is a bayesian network. Bayesian network is a directed acyclic graph that captures the interdependencies between variables. Nodes represent random variables, whereas edges represent relationships (the conditional probabilities) between variables.</p>

<p><img src="/assets/img/scm-bn-example.png" alt="Figure 3: Illustration of a bayesian network" /></p>

<p><em>Figure 3: Illustration of a bayesian network.</em></p>

<p>In a bayesian network, the value of a node is independent of the rest of the variables in the graph given its parents. The relationship between arbitrary nodes are not necessarily causal. Therefore, we need to assume that the directed edges are the actual causal effect. This is where the unconfoundedness assumption plays in SCM. We need to believe and be sure that the bayesian network that we build have no unmeasured confounders.</p>

<h2 id="how-to-build-bayesian-network">How to build bayesian network?</h2>
<p>So now we might ask: how do we build this bayesian network? If we have a lot of features, do we need to manually specify the causal relationships between the features that we have? There are some ways in which we can utilize correlation to automatically build the bayesian network, such as the <a href="https://arxiv.org/abs/1803.01422" target="_blank" rel="noopener noreferrer">NOTEARS</a> algorithm. This automatic training is also known as structure learning. However, we can‚Äôt just blindly use the result. It‚Äôs better to have an expert to review the structure and fix the relationship (add, remove, or flip edges) in the bayesian network if deemed necessary.</p>

<p><img src="/assets/img/scm-bn-build.png" alt="Figure 4: Steps to build a bayesian network" /></p>

<p><em>Figure 4: Steps to build a bayesian network.</em></p>

<p>Figure 4 above shows the steps in building a bayesian network:</p>

<ul>
<li>First, we can use some algorithm (NOTEARS) to automatically build edges between our variables.</li>
<li>As a consequence of the learning process, the edges have weights. Hence we can remove some edges that are below a certain threshold. This results in an initial causal structure build automatically from the algorithm.</li>
<li>We can then further proceed to fix the causal structure by flipping, removing, or adding edges based on our domain knowledge.</li>
</ul>

<h2 id="what-lies-underneath-bayesian-network">What lies underneath bayesian network?</h2>
<p>In the classical literature, bayesian networks are mostly either fully discrete or fully gaussian. This means that all the nodes in the graph are either discrete or continuous. The reason is because of closure properties: fully discrete allows us to model the conditional probability distribution with conditional table and they are all jointly multinomial random variable, whereas fully gaussian allows every operation (conditional, marginal, etc) to always result in another gaussian. There are other approaches where we use a non-parametric version of bayesian network which allows us to work flexibly with different types of distributions.</p>

<h2 id="parameter-estimation-in-bayesian-network">Parameter estimation in bayesian network</h2>
<p>The structure tells us the causal relationships, and for each of these relationships, there is a distribution which tells us the probability of attaining a certain state given for any variable given the states of the parent node. In a fully discrete bayesian network, the size of the conditional probability table would be the number of states of current node multiplied by the parents state. This would be total parameter that we need to estimate from data. To estimate these parameters, one can use maximum likelihood estimation (usually just involves taking counts and fractions) which produces a point estimate or use bayesian estimation and allows us to put a prior belief on the estimate.</p>

<p><img src="/assets/img/scm-bn-trained.png" alt="Figure 5: A conditional probability distributions for each node in bayesian network" /></p>

<p><em>Figure 5: A conditional probability distributions for each node in bayesian network.</em></p>

<p>Figure 5 shows the illustration after fitting the parameters of our 3 variables on the observational data. Each node is governed by a conditional probability. If a variable does not have any parents, then it‚Äôs just its own probability.</p>

<hr />

<h1 id="the-operation-in-bayesian-network">The operation in bayesian network</h1>
<p>With a bayesian network defined, one might ask: what can do with it? There are two operations that we can apply on a bayesian networks node: conditioning and intervention. Do note that conditioning is not always the same as the causal effect, that is why it is better to always do an intervention if we are able to and especially if we want to gain insight using the bayesian network.</p>

<h2 id="conditioning">Conditioning</h2>
<p>Conditioning is an observational inference: having observed the data that we have, what would the probability of a certain variable be given that we observe some parents state. Since conditioning is observational, we can do conditioning between any arbitrary nodes without having to follow the directed edge (yes including between nodes that doesn‚Äôt have any directed arrows). Conditioning is usually done in a setting where one cannot do an intervention. 
In conditioning, we can have a non-causal correlation flowing from one node to another node if we are not careful, leading to an incorrect interpretation. In other words, conditioning between arbitrary nodes without regarding the causal effect might lead to a spurious correlation. Consider this case below:</p>

<p><img src="/assets/img/scm-ass-caus.png" alt="Figure 6: Association vs causation in a graph (&lt;a href=&quot;https://www.bradyneal.com/causal-inference-course&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;credits&lt;/a&gt;)" /></p>

<p><em>Figure 6: Association vs causation in a graph (<a href="https://www.bradyneal.com/causal-inference-course" target="_blank" rel="noopener noreferrer">credits</a>).</em></p>

<p>The true causal effect from treatment $T$ to outcome $Y$ flows through $M1$ and $M2$. However, in the case above there are two other paths in which non-causal correlation can flow from $T$ to $Y$:</p>

<ul>
<li>
$W1$, $W2$, $W3$


</li>
<li>
$X1$, $X2$, $X3$


</li>
</ul>

<p>The $W$ path is known as confounder path. In bayesian network, confounder path can mess with the treatment effect because it affect how treatment $T$ is assigned, making $Y$ also affected. The only way to measure the treatment effect correctly in this case is by conditioning on all possible confounder. In the case of bayesian network, if we intervene on $T$, then the non-causal association in the W path is automatically blocked. If we cannot do an intervention and would want to derive treatment effect from observational data, then the W path needs to be conditioned on, otherwise the non-causal association will render the causal effect incorrect. In the $W$ path, conditioning on children of colliders (either $W1$ or $W3$) also blocks the non-causal association, so it doesn‚Äôt have to be on the confounder node.</p>

<p>The $X$ path is known as colliders. Contrary to the confounder, conditioning on the collider can make non-causal association flows through the path. We will not go into details but here is an excellent <a href="http://corysimon.github.io/articles/berksons-paradox-are-handsome-men-really-jerks/" target="_blank" rel="noopener noreferrer">example of colliders</a>. The idea is that if we have colliders, we should not apply conditioning on that variable as it can mess with our interpretation.</p>

<p><img src="/assets/img/scm-cond-intv.png" alt="Figure 7: Visual illustration on the difference between conditioning and intervening (&lt;a href=&quot;https://www.bradyneal.com/causal-inference-course&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;credits&lt;/a&gt;)" /></p>

<p><em>Figure 7: Visual illustration on the difference between conditioning and intervening (<a href="https://www.bradyneal.com/causal-inference-course" target="_blank" rel="noopener noreferrer">credits</a>).</em></p>

<h2 id="intervention">Intervention</h2>
<p>To gain insight from our model, we want to query our model under different observation. With intervention, we can replace the probability distributions of a certain state. If this state has a children, then we can simulate what would have happened to the children marginal probability if we do an intervention to the node. Unlike conditioning, intervention on a node will only affect its children according to the causal direction.
Figure 8 and 9 below shows how we can do an intervention to simulate the target variable.</p>

<p><img src="/assets/img/scm-bn-before-intv.png" alt="Figure 8: Marginal probability of getting high or low grades before doing an intervention" /></p>

<p><em>Figure 8: Marginal probability of getting high or low grades before doing an intervention.</em></p>

<p>Figure 8 shows the calculation of the joint probability between Grade, Study, and School Support, and the marginal probability of Grade. Remember that $P(S)$,  $P(SS)$, and $P(G \mid S, SS)$ are calculated from data. These are the parameters that we estimated after we have the causal structure. With the estimated parameter and causal structure, we calculate the marginal probability of Grade. This is the marginal probability that we learn from data before we do any intervention.</p>

<p><img src="/assets/img/scm-bn-after-intv.png" alt="Figure 9: Marginal probability of getting high or low grades after doing an intervention on the study variable" /></p>

<p><em>Figure 9: Marginal probability of getting high or low grades after doing an intervention on the study variable.</em></p>

<p>Figure 9 shows how it would look like to Grade variable if we do an intervention on Study. Here we force $P(S)$ to hold a certain value: in plain English we can interpret this as forcing everyone to Study. We can see after intervening, the marginal probability of Grade from 0.605 to 0.875 on the marginal probability $P(G=\text{High})$. This means that we can assume that if we nudge students to study more then it would yield better grades that is good for the school.</p>

<p>Please note that when doing intervention, we assume that the change in the target variables marginal probability happens on the whole population. However, when we build the causal structure and fit the parameters for every variables, we do it on the observational data. So it‚Äôs important to make sure that we have enough data first. Ensuring that we have enough data is most commonly known as fulfilling the <a href="https://www.bradyneal.com/Introduction_to_Causal_Inference-Dec17_2020-Neal.pdf" target="_blank" rel="noopener noreferrer">positivity/overlap</a> assumption.</p>

<hr />

<h1 id="recap-and-closing">Recap and closing</h1>
<p>In this post we cover structural causal model as a way to capture causal language. We have seen:</p>

<ul>
<li>Simpson‚Äôs paradox in a graph.</li>
<li>Directed acyclic graph, especially bayesian network, as a structure to model both association and causation relationship between variables.</li>
<li>How to build bayesian network given data.</li>
<li>Condition and intervention as operations that we can apply in bayesian network.</li>
</ul>

<p>Thanks for reading this post! Contact me on twitter for feedback <a href="https://twitter.com/rezkaaufar" target="_blank" rel="noopener noreferrer">@rezkaaufar</a></p>


  </main>

  <footer>
    <div class="footer-top">
      <div>¬© <span id="copyright-year">2026</span> Rezka Leonandya.</div>
      <div class="meta">Built with Jekyll + Featherweight-inspired minimal styling.</div>
    </div>
    <div class="meta"><span id="page-size"></span> ¬∑ <span id="load-time"></span></div>
  </footer>
  <script>
    (function () {
      const sizeEl = document.getElementById('page-size');
      const timeEl = document.getElementById('load-time');
      const yearEl = document.getElementById('copyright-year');
      const update = () => {
        if (sizeEl) sizeEl.textContent = `Size: ${document.documentElement.outerHTML.length} bytes`;
        if (timeEl) timeEl.textContent = `Load time: ${Math.round(performance.now())} ms`;
        if (yearEl) yearEl.textContent = new Date().getFullYear();
      };
      if (document.readyState === 'complete') {
        update();
      } else {
        window.addEventListener('load', update, { once: true });
      }
    })();
  </script>
</body>

</html>